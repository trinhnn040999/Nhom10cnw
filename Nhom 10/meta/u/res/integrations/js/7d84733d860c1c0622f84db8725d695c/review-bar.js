angular.module("ReviewBarDirective",["firebase"]).directive("reviewBar",["$location","$firebaseObject","$firebaseArray","$timeout",function(e,r,t,a){return{templateUrl:"/integrations/templates/review-bar.html",scope:{ratingValue:"=",hoverRating:"=",permanent:"=",originalRating:"=",name:"=",postedReview:"="},link:function(e,r,t){e.stars=[],e.permanent=0;for(var i=0;i<5;i++)e.stars.push({filled:i<e.hoverRating});e.updateStarColor=function(){for(var r=0;r<5;r++)e.hoverRating>0?(e.stars[r].filled=r<e.hoverRating,e.stars[r].rated=!1):(e.stars[r].rated=r<e.originalRating,e.stars[r].filled=!1)},e.toggle=function(r){var t={rating:r+1,timestamp:Firebase.ServerValue.TIMESTAMP};if(e.postedReview)e.postedReview.set(t);else{var a=new Firebase("trellointegrations.firebaseio.com/reviews/"+e.sanitize(e.name[0][0]));e.postedReview=a.push(t)}e.permanent=r+1},e.hover=function(r){e.hoverRating=r+1,e.updateStarColor()},e.noHover=function(){e.hoverRating=e.permanent,e.updateStarColor()},e.sanitize=function(e){return e.replace(/[\.#\$\[\]]/g,"")},new Firebase("trellointegrations.firebaseio.com/reviews/"+e.sanitize(e.name[0][0])).on("child_added",(function(r,t){var i=r.val();e.reviewCount+=1,e.runningTotal+=i.rating,e.originalRating=Math.round(e.runningTotal/e.reviewCount),a((function(){e.updateStarColor()}),0)})),e.originalRating=0,e.reviewCount=0,e.runningTotal=0,e.updateStarColor()}}}]);